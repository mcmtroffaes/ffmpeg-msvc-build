version: 1.0.{build}
image: Visual Studio 2019
environment:
  matrix:
    - LINKAGE: static
      RUNTIME_LIBRARY: MD
      TOOLSET: v142
      APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      LICENSE: LGPL21

matrix:
  fast_finish: true
platform:
  - x64
configuration:
  - Release
install:
  - echo "set(VCPKG_TARGET_ARCHITECTURE %PLATFORM%)" > C:\Tools\vcpkg\triplets\custom-triplet.cmake
    # TODO get this from %RUNTIME_LIBRARY%
  - echo "set(VCPKG_CRT_LINKAGE dynamic)" >> C:\Tools\vcpkg\triplets\custom-triplet.cmake
  - echo "set(VCPKG_LIBRARY_LINKAGE %LINKAGE%)" >> C:\Tools\vcpkg\triplets\custom-triplet.cmake
  - echo "set(VCPKG_PLATFORM_TOOLSET %TOOLSET%)"  >> C:\Tools\vcpkg\triplets\custom-triplet.cmake
    # TODO get this from %Configuration% (to lower case)
  - echo "set(VCPKG_BUILD_TYPE release)" >> C:\Tools\vcpkg\triplets\custom-triplet.cmake
  - vcpkg install ffmpeg:custom-triplet
build_script:
  - vcpkg export ffmpeg:custom-triplet --output=export --raw
  - dir /s /b C:\Tools\vcpkg\export\installed\custom-triplet\
test: off
artifacts:
  - path: '*.zip'
deploy:
  description: 'Headers and libraries for FFmpeg.'
  provider: GitHub
  auth_token:
    secure: QSdxjkooPHApqh95gD9duaZBxmv/5zWzDcukjNQGmbedwEu0BvzgA6HUEXpvni25
  artifact: /.*\.zip/
  draft: false
  prerelease: false
  on:
    appveyor_repo_tag: true
cache:
  - c:\tools\vcpkg\installed\
